`Kubernetes` 是一个软件系统, 它允许在其上很容易地部署和管理容器化的应用. 它依赖于 `Linux` 容器的特性来运行异构应用.

# 集群架构

* 主节点: 承载着 `Kubernetes` 控制和管理整个集群系统的控制面板.
* 工作节点: 它们运行用户实际部署的应用.

![](assert/Pasted%20image%2020220628175414.png)

**控制面板**

控制面板用于控制集群并使它工作. 它包含多个组件, 组件可以运行在单个节点上或者通过副本分别部署在多个主节点以确保高可用性. 这些组件是:

* `Kubernetes API` 服务器
* `Scheculer` 调用应用
* `Controller manager` 执行集群级别的功能, 复制组件, 持续跟踪工作节点, 处理节点失败等
* `etcd` 可靠的分布式数据存储, 能持久化存储集群配置

**工作节点**

工作节点是运行容器化应用的机器. 运行, 监控和管理应用服务的任务是由以下组件完成的:

* `Docker`, `rtk`, `containerd` 等容器
* `Kubelet`, 与控制面板的 `API` 服务器通信, 并管理所在节点的容器.
* `Kubernetes Service Proxy(kube-proxy)` 负责组件之间的负载均衡网络流量

# 在 `Kubernetes` 中运行的应用

1. 通过描述怎样成为一个运行的容器,  `API` 服务器处理应用的描述, 调度器调度指定组的应用到可用的工作节点上. 调度是基于每组所需的计算资源, 以及调度时每个节点未分配的资源.
2. 一旦应用程序运行起来, `Kubernetes` 就会不断地确认应用程序的部署状态的始终与描述相匹配. 进程崩溃或停止响应时就会重启. 同理, 如果整个工作节点死亡或无法访问, `Kubernetes` 将为在故障节点上运行的所有容器选择新节点, 并在新选择的节点上运行它们.
3. 当应用程序运行时, 可以决定要减少或增加副本量, 而 `Kubernetes` 将分别增加附加的或停止多余的副本. 甚至可以把决定最佳副本数目的工作交给 `Kubernetes`, 它可以根据实时指标(`CPU`负载, 内存消耗, 每秒查询或应用公开的其他指标)自动调整副本数.
4. 命中移动目标, 当容器被复制并分布到整个集群中时, 客户端能够轻松的找到提供特定服务的容器. 告诉 `Kubernetes` 哪些容器提供相同的服务, 而 `Kubernetes` 将通过一个静态`IP`地址暴露所有容器, 并将该地址暴露给集群中运行的所有程序. 这是通过环境变量完成的, 但是客户端也可以通过 `DNS` 查找服务`IP`. `kube-proxy` 将确保到服务的连接可跨提供服务的容器实现负载均衡.

# 使用 `Kubernetes` 的好处

1. 简化应用程序部署
2. 更好的利用硬件
3. 健康检查和自修复
4. 自动扩容
5. 简化应用部署